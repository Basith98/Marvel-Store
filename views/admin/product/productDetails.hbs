<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css" />
<link rel="stylesheet" href="/stylesheets/style copy.css" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet"
  href="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569006288/BBBootstrap/choices.min.css?version=7.0.0">
<script
  src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569006273/BBBootstrap/choices.min.js?version=7.0.0"></script>

{{!--
<script src="https://code.jquery.com/jquery-3.6.0.min.js">
</script> --}}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/javascripts/comboTreePlugin.js" type="text/javascript"></script>

<div class="container-fluid bg-soft">
  <div class="row">
    <div class="col-12 mt-5">
      <class class="layout-container">
        <div class="layout-page">
          <div class="content-wrapper">
            <div class="card">
              <div class="card-header">
                <h5>Add Product</h5>
                <span>Please try to fill out all the form feild</span>
              </div>
              <div class="card-block">
                <!-- Row start -->
                <div class="row">
                  <div class="col-lg-12 col-xl-12">
                    <form id="productform">
                      <div class="sub-title">ðŸŽˆ</div>
                      <!-- Nav tabs -->
                      <ul class="nav nav-tabs  tabs" role="tablist">
                        <li class="nav-item">
                          <a class="nav-link active bg-c-lite-green text-dark" data-toggle="tab" id="vitalInfoTab"
                            href="#vitalInfo" role="tab">Vital
                            Info</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link bg-c-lite-green text-dark" data-toggle="tab" id="variationTab"
                            href="#variations" role="tab">Variations</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link bg-c-lite-green text-dark" data-toggle="tab" id="offersAndCouponsTabId"
                            href="#offersAndCoupons" role="tab">Offers
                            and
                            Coupons</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link bg-c-lite-green text-dark" data-toggle="tab" id="imageTab" href="#Images"
                            role="tab">Images</a>
                        </li>
                      </ul>
                      <!-- Tab panes -->
                      <div class="tab-content tabs card-block">
                        <div class="tab-pane active" id="vitalInfo" role="tabpanel">
                          <div class="row gx-5">
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Product Name</label>
                              <input type="select" name="productName" value="{{categoryDetails.name}}" label="hello"
                                class="form-control" id="basic-default-fullname" placeholder="Product name"
                                required="required" />
                            </div>
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Brand Name</label>
                              <input type="select" name="brandName" value="{{categoryDetails.name}}" label="hello"
                                class="form-control" id="basic-default-fullname" placeholder="Brand name"
                                required="required" />
                            </div>
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Category</label>
                              <input type="text" name="categoryId" value="{{categoryDetails.parent}}"
                                id="justAnotherInputBox" placeholder="Type to filter" autocomplete="on" />
                            </div>
                            {{!-- <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Price</label>
                              <input type="number" name="price" value="{{categoryDetails.price}}" label="hello"
                                class="form-control" id="basic-default-fullname" placeholder="price"
                                required="required" />
                            </div> --}}
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Limit per user</label>
                              <input type="number" name="limitPerUser" value="{{categoryDetails.limitPerUser}}"
                                label="hello" class="form-control" id="basic-default-fullname"
                                placeholder="Limit per user" required="required" />
                            </div>
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">material type</label>
                              <input type="text" name="outerMaterialType" value="{{categoryDetails.name}}" label="hello"
                                class="form-control" id="basic-default-fullname" placeholder="Product material type" />
                            </div>
                            <div class="col-6 mt-4">
                              <label class="form-label" for="basic-default-fullname">Description</label>
                              <textarea class="form-control" placeholder="Description box" name="description"
                                id="exampleFormControlTextarea1" rows="3"></textarea>
                            </div>

                          </div>
                          <div class="float-right mt-5 mr-4">
                            <btn id="toVariation" class="btn btn-info">Next</btn>
                          </div>
                          {{!--
                    </form> --}}
                  </div>

                  <div class="tab-pane" id="variations" role="tabpanel">
                    <div class="container-fluid mt-3 mb-5 ml-0 warningBorder" id="WarningDiv"
                      style="background-color: white;">
                      <div style="display: flex;">

                        <i class='fas fa-exclamation-triangle mt-2' style='font-size:23px;color: #FFAF38'></i>
                        <p class="mt-3 ml-2" style="color:#0F1111" id="warningContent">Changes can't be applied
                          after confirmation!</p>
                      </div>
                    </div>
                    <div class="row mb-5" id="colorAndSize-select-div">
                      <div class="col-md-6">
                        <select id="color-multiple-remove-button" name="colors" required placeholder="Select colors"
                          multiple>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <select id="size-multiple-remove-button" name="sizes" required placeholder="Select sizes"
                          multiple>
                        </select>
                      </div>
                    </div>
                    <div class="float-right mt-5 mr-4" id="colorAndSize-confirm">
                      <btn onclick="sizeAndColorVariation()" class="btn btn-primary">Confirm</btn>
                    </div>
                    <div class="container ml-5">
                      <div id="table" class="table-editable">
                        <table class="table table-hover" id="sizeColorTable">

                        </table>
                      </div>
                    </div>
                    {{!-- <btn id="variation_submit" class="btn btn-secondary" onclick="sub()">submit</btn> --}}
                    <div class="float-right mt-5 mr-4" id="variation-tab-next-btn" hidden>
                      <btn id="toVitalInfo" class="btn btn-secondary">Back</btn>
                      <btn id="toOffersAndCoupons" class="btn btn-info">Next</btn>
                    </div>
                  </div>
                  <div class="tab-pane" id="offersAndCoupons" role="tabpanel">
                    <p class="m-0">3. This is Photoshop's version of Lorem IpThis is Photoshop's version of Lorem
                      Ipsum. Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis
                      bibendum auctor, nisi elit consequat ipsum, nec sagittis sem nibh id elit. Lorem ipsum dolor
                      sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean
                      mas Cum sociis natoque penatibus et magnis dis.....</p>
                    <div class="float-right mt-5 mr-4">
                      <btn id="backtoVariation" class="btn btn-secondary">Back</btn>
                      <btn id="toImage" class="btn btn-info">Next</btn>
                    </div>
                  </div>


                  <div class="tab-pane" id="Images" role="tabpanel">
                    <div class="row gx-5">
                      <div class="col-3 mt-4">
                        <h5 class="card-title">Main Image</h5>

                        <div class="card" style="width: 15rem;">
                          <div class="preview">
                            <img id="file-ip-1-preview" src="/images/image-placeholder.jpg" class="card-img-top"
                              style="height:18rem ; width:15rem ;">
                          </div>
                          <div class="card-body" style="width:10rem ;">
                            <input type="file" title=" " name="mainImage" id="file-ip-1" accept="image/*"
                              onchange="showPreview(event, 'file-ip-1-preview');">

                          </div>
                        </div>
                      </div>


                      <div class="col-7 mt-5">
                        <br>
                        <h4>Add product image for creative marketing</h4>
                        <br>
                        <p style="size: 16rem; line-height: 1.8;" class="fw-3">Online shopping might be more
                          popular
                          than ever,
                          but buyers still
                          wonder what their
                          product will look like when it arrives. Donâ€™t you?

                          Thatâ€™s why quality, accurate product photos are so important. 67% of consumers say the
                          quality of each product image is very important when choosing and purchasing products.
                          Customers also think that product image quality is more valuable than product
                          information
                          (63%), a detailed product description (54%) or customer ratings and reviews (53%).</p>
                      </div>
                    </div>
                    <div class="row gx-5">
                      <div class="col-3 mt-4">
                        <div class="card" style="width: 15rem;">
                          <div class="preview">
                            <img id="file-ip-2-preview" src="/images/image-placeholder.jpg"
                              style="height:18rem ; width:15rem ;">
                          </div>
                          <div class="card-body" style="width:10rem ;">
                            <input type="file" title=" " name="subImage1" id="file-ip-2" accept="image/*"
                              onchange="showPreview(event,'file-ip-2-preview');">

                            {{!-- <a href="#" class="btn btn-primary">Go somewhere</a> --}}
                          </div>
                        </div>
                      </div>
                      <div class="col-3 mt-4">
                        <div class="card" style="width: 15rem;">
                          <div class="preview">
                            <img id="file-ip-3-preview" src="/images/image-placeholder.jpg"
                              style="height:18rem ; width:15rem ;">
                          </div>
                          <div class="card-body" style="width:10rem ;">
                            <input type="file" title=" " name="subImage2" id="file-ip-3" accept="image/*"
                              onchange="showPreview(event, 'file-ip-3-preview');">

                            {{!-- <a href="#" class="btn btn-primary">Go somewhere</a> --}}
                          </div>
                        </div>
                      </div>

                      <div class="col-3 mt-4">
                        <div class="card" style="width: 15rem;">
                          <div class="preview">
                            <img id="file-ip-5-preview" src="/images/image-placeholder.jpg"
                              style="height:18rem ; width:15rem ;">
                          </div>
                          <div class="card-body" style="width:10rem ;">
                            <input type="file" title=" " name="subImage3" id="file-ip-5" accept="image/*"
                              onchange="showPreview(event, 'file-ip-5-preview');">

                            {{!-- <a href="#" class="btn btn-primary">Go somewhere</a> --}}
                          </div>
                        </div>
                      </div>
                      <div class="col-3 mt-4">
                        <div class="card" style="width: 15rem;">
                          <div class="preview">
                            <img id="file-ip-4-preview" src="/images/image-placeholder.jpg"
                              style="height:18rem ; width:15rem ;">
                          </div>
                          <div class="card-body" style="width:10rem ;">
                            <input type="file" title=" " name="subImage4" id="file-ip-4" accept="image/*"
                              onchange="showPreview(event,'file-ip-4-preview');">

                            {{!-- <a href="#" class="btn btn-primary">Go somewhere</a> --}}
                          </div>
                        </div>
                      </div>

                    </div>
                    <div class="float-right mt-5 mr-4">
                      <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                  </div>
                </div>
                </form>
              </div>

            </div>
            <!-- Row end -->
          </div>
        </div>
    </div>
  </div>
  </class>
</div>
</div>
</div>
<style>
  input[typ=file] {
    color: transparent;
  }
</style>

<script src="https://unpkg.com/axios@0.25.0/dist/axios.min.js"></script>
<script type="text/javascript">
  var comboTree2;
  let size, color, selectedColors = [];

  const form = document.getElementById("productform")
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    formData.append('sizes', JSON.stringify(SizeAndColorVariationTableData()))
    console.log([...formData]);
    await axios.post('/admin/updateProduct', formData);
  })


  /*$("#productform").submit(async (e) => {
    // const formData = new FormData();
    let product = $("#productform").serializeArray();
    e.preventDefault();
    //let formdata = new FormData(this.form);
    var form_data = new FormData($('#productform')[0]);

    let data = {
      withfiles: form_data,
      product: product,
      sizeColor: SizeAndColorVariationTableData()
    }

    await axios.post('/admin/updateProduct', data).then((res) => {
      Swal.fire({
        icon: 'success',
        title: res.data.transcationalInformation.message,
        showConfirmButton: false,
        timer: 1500
      })
      location.href = "report.html";
    }) 
    var formData = new FormData(this);

    $.ajax({
      type: 'POST',
      url: '/admin/updateProduct',
      data: formData,
      success: function (data) {
        console.log(data);
      },
      error: function (error) {
        console.log(`Error ${error}`);
      }

    });
  });*/

  function SizeAndColorVariationTableData() {
    var myRows = [];
    var $headers = $("th")
    //$headers.toLowerCase();
    console.log("header", $headers);
    var $rows = $("tbody tr").each(function (index) {
      $cells = $(this).find("td");
      myRows[index] = {};
      $cells.each(function (cellIndex) {
        myRows[index][$($headers[cellIndex]).html()] = $(this).html();
        console.log("value", myRows[index][$($headers[cellIndex]).html()])
      });
    });
    console.log(myRows);
    return myRows
  }

  function setSelectOptions(array, tagId) {
    $.each(array, function (index, value) {
      var tagOption = ('<option value=' + value.sizeId + '>' + value.sizeMap + '</option>');
      $(tagId).append(tagOption);
    });
    var multipleCancelButton = new Choices(tagId, {
      removeItemButton: true,
      searchResultLimit: 5,
      renderChoiceLimit: 5
    });
  }
  function sub() {
    let colors = document.getElementById('color-multiple-remove-button').options;
    $.each(colors, (index, element) => {
      selectedColors.push(element.value);
    })
    console.log("SC = ", typeof selectedColors[0]);
  }

  jQuery(document).ready(async function ($) {
    try {
      let parentCategoryss = false;
      const category = await axios.get('/admin/category')
      size = await axios.get('/admin/sizesDTO')
      color = await axios.get('/admin/colorDTO')
      setSelectOptions(size.data.sizes, '#size-multiple-remove-button');

      $.each(color.data.colors, function (index, value) {
        var tagOption = ('<option value=' + value.colorId + '>' + value.colorMap + '</option>');
        $('#color-multiple-remove-button').append(tagOption);
      });
      var multipleCancelButton = new Choices('#color-multiple-remove-button', {
        removeItemButton: true,
      });

      comboTree2 = $('#justAnotherInputBox').comboTree({
        source: category.data.parentCategories,
        isMultiple: false
      });
    }
    catch (e) {
      console.log("sfkjshdf", e)
    }
  });

  $('#toVariation').click(function () {
    $('#variationTab').click();
  });
  $('#backtoVariation').click(function () {
    $('#variationTab').click();
  })

  $('#toVitalInfo').click(function () {
    $('#vitalInfoTab').click();
  });
  $('#toOffersAndCoupons').click(function () {
    $('#offersAndCouponsTabId').click();
  })
  $('#toImage').click(function () {
    console.log("Image loadedAt ")
    $('#imageTab').click();
  })

  function showPreview(event, id) {
    if (event.target.files.length > 0) {
      var src = URL.createObjectURL(event.target.files[0]);
      var preview = document.getElementById(id);
      preview.src = src;
      preview.style.display = "block";
    }
  }

  function sub() {
    console.log("Call");
    let elements = document.getElementsByName("colors");

    console.log("color", elements);
  }

  function sizeAndColorVariation() {
    document.getElementById("colorAndSize-confirm").hidden = true;
    document.getElementById("WarningDiv").disabled = true;
    document.getElementById("color-multiple-remove-button").disabled = true;
    document.getElementById("variation-tab-next-btn").hidden = false;

    let tableRow = ``;
    tableRow = `<thead>
                  <tr>
                      <th>SL NO</th>
                      <th hidden>colorId</th>
                      <th hidden>sizeId</th>
                      <th>COLOR MAP</th>
                      <th>SIZE MAP</th>
                      <th>Quantity</th>
                       <th>Price</th>
                    </tr>
                  </thead>`;
    let selectedColors = Array.prototype.slice.call(document.querySelectorAll('#color-multiple-remove-button option:checked')).map(function (v) {
      return v.value;
    });

    let selectedSizes = Array.prototype.slice.call(document.querySelectorAll('#size-multiple-remove-button option:checked')).map(function (v) {
      return v.value;
    });
    let colors = color.data.colors;
    let sizes = size.data.sizes;
    let slNo = 0;
    colors.map(function (colorElement) {
      const arrOfselectedColors = selectedColors.map(Number);
      const arrOfselectedSizes = selectedSizes.map(Number);

      if (arrOfselectedColors.includes(colorElement.colorId)) {
        sizes.map((sizeElement) => {
          if (arrOfselectedSizes.includes(sizeElement.sizeId)) {
            let data = {
              color_id: colorElement._id,
              size_id: sizeElement._id,
              color: colorElement.color,
              size: sizeElement.size,
              colorMap: colorElement.colorMap,
              sizeMap: sizeElement.sizeMap,
              quantity: "",
              price: "",
              itemCondition: "",
            }

            let rows = `<tr>
                          <td>${++slNo}</td>
                          <td hidden>${data.color_id}</td>
                          <td hidden>${data.size_id}</td>
                          <td> ${data.colorMap}  <span class="dot-in-tr mt-3 ml-3" style="background-color:${data.color};"></span>  </td>
                          <td > ${data.sizeMap}  </td>
                          <td onkeyup="isNumber()" contenteditable="true" class="allow_only_numbers"> ${data.quantity}  </td>
                          <td onkeyup="isNumber()" contenteditable="true" class="allow_only_numbers"> ${data.price}  </td>
                        </tr>`;
            tableRow = tableRow.concat(rows);
          }
        })
      }
    });
    let totalTableRows = (tableRow)
    $("#sizeColorTable tr").remove();
    $('#sizeColorTable').append(totalTableRows);
  }

  function isNumber() {
    $(`.allow_only_numbers`).keydown(function (e) {
      if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110]) !== -1 ||
        ((e.keyCode == 65 || e.keyCode == 86 || e.keyCode == 67) && (e.ctrlKey === true || e.metaKey === true)) ||
        (e.keyCode >= 35 && e.keyCode <= 40)) {
        return;
      }
      if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
        e.preventDefault();
      }
    });

  }

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"> </script>

<style>
  @import url('https://fonts.googleapis.com/css?family=Montserrat:400,500');

  tr:nth-of-type(odd) {
    background: rgb(201, 227, 253);
  }

  tr:nth-of-type(even) {
    background: rgb(215, 239, 249);
  }

  th {
    background: #3498db;
    color: white;
    font-weight: bold;
  }

  @import "compass/css3";

  .table-editable {
    position: relative;

    .glyphicon {
      font-size: 20px;
    }
  }

  table {
    width: 750px;
    border-collapse: collapse;
    margin: 50px auto;
  }

  td,
  th {
    padding: 8px;
    border: 1px solid #ccc;
    text-align: left;
    font-size: 16px;
  }

  .table-remove {
    color: #700;
    cursor: pointer;

    &:hover {
      color: #f00;
    }
  }

  .table-up {
    color: #007;
    cursor: pointer;

    &:hover {
      color: #00f;
    }
  }

  .table-down {
    color: #007;
    cursor: pointer;

    &:hover {
      color: #00f;
    }
  }

  .table-add {
    color: #070;
    cursor: pointer;
    position: absolute;
    top: 8px;
    right: 0;

    &:hover {
      color: #0b0;
    }
  }

  .dot-in-tr {
    height: 18px;
    width: 18px;
    border-radius: 50%;
    display: inline-block;
  }

  .warningBorder {
    width: 25%;
    height: ;
    border-style: solid;
    border-color: #FFAF38;
    border-radius: 7px;
    border-left-width: 12px;
  }
</style>